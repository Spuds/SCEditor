/* SCEditor v1.5.3 | (C) 2017, Sam Clarke | sceditor.com/license */

!function(e){"use strict";e.sceditor.plugins.undo=function(){var e,t,o=this,r=0,u=50,n=[],a=[],c=!1,d=function(o){c=!0,t=o.value,e.sourceMode(o.sourceMode),e.val(o.value,!1),e.focus(),o.sourceMode?e.sourceEditorCaret(o.caret):e.getRangeHelper().restoreRange(),c=!1},s=function(e,t){var o,r,u,n,a=e.length,c=t.length,d=Math.max(a,c);for(o=0;o<d&&e.charAt(o)===t.charAt(o);o++);for(u=a<c?c-a:0,n=c<a?a-c:0,r=d-1;r>=0&&e.charAt(r-u)===t.charAt(r-n);r--);return r-o+1};o.init=function(){u=(e=this).undoLimit||u,e.addShortcut("ctrl+z",o.undo),e.addShortcut("ctrl+shift+z",o.redo),e.addShortcut("ctrl+y",o.redo),e.commands.undo||(e.commands.undo={txtExec:o.undo,exec:o.undo,tooltip:"Undo"},e.commands.redo={txtExec:o.redo,exec:o.redo,tooltip:"Redo"})},o.undo=function(){var t=a.pop(),o=e.val(null,!1);return t&&!n.length&&o===t.value&&(t=a.pop()),t&&(n.length||n.push({caret:e.sourceEditorCaret(),sourceMode:e.sourceMode(),value:o}),n.push(t),d(t)),!1},o.redo=function(){var e=n.pop();return a.length||(a.push(e),e=n.pop()),e&&(a.push(e),d(e)),!1},o.signalReady=function(){var o,r=e.val(null,!1);o=""===r?{end:0,start:0}:this.sourceEditorCaret(),t=r,a.push({caret:o,sourceMode:this.sourceMode(),value:r})},o.signalValuechangedEvent=function(o){var d=o.rawValue;u>0&&a.length>u&&a.shift(),!c&&t&&t!==d&&(n.length=0,(r+=s(t,d))<20||r<50&&!/\s$/g.test(o.rawValue)||(a.push({caret:e.sourceEditorCaret(),sourceMode:e.sourceMode(),value:d}),r=0,t=d))}}}(jQuery);