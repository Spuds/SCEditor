/* SCEditor v1.5.3 | (C) 2017, Sam Clarke | sceditor.com/license */

!function(e){"use strict";e.sceditor.plugins.undo=function(){var e,t,r=this,o=0,u=50,n=-1,a=[],c=!1,s=function(r){c=!0,t=r.value,e.sourceMode(r.sourceMode),e.val(r.value,!1),e.focus(),r.sourceMode?e.sourceEditorCaret(r.caret):e.getRangeHelper().restoreRange(),c=!1},d=function(e,t){var r,o,u,n,a=e.length,c=t.length,s=Math.max(a,c);for(r=0;r<s&&e.charAt(r)===t.charAt(r);r++);for(u=a<c?c-a:0,n=c<a?a-c:0,o=s-1;o>=0&&e.charAt(o-u)===t.charAt(o-n);o--);return o-r+1},i=function(e,t){for(;t<a.length-1;)a.pop();a.push(e),n=t+1};r.init=function(){u=(e=this).undoLimit||u,e.addShortcut("ctrl+z",r.undo),e.addShortcut("ctrl+shift+z",r.redo),e.addShortcut("ctrl+y",r.redo)},r.undo=function(){var t=e.val(null,!1);return-1!==n&&(n===a.length-1&&(i({caret:e.sourceEditorCaret(),sourceMode:e.sourceMode(),value:t},n),n-=1),n-=1,s(a[n]),!1)},r.redo=function(){return n!==a.length-1&&(n+=1,s(a[n]),!1)},r.signalReady=function(){var r,o=e.val(null,!1);r=""===o?{end:0,start:0}:this.sourceEditorCaret(),t=o,i({caret:r,sourceMode:this.sourceMode(),value:o},n)},r.signalValuechangedEvent=function(r){var s=r.rawValue;u>0&&a.length>u&&a.shift(),!c&&t&&t!==s&&((o+=d(t,s))<20||o<50&&!/\s$/g.test(r.rawValue)||(i({caret:e.sourceEditorCaret(),sourceMode:e.sourceMode(),value:s},n),o=0,t=s))}}}(jQuery);